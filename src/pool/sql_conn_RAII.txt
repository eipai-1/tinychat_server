#pragma once

#include "pool/sql_conn_pool.hpp"

#include <vector>
#include <map>
#include <string>
#include <optional>

using result_type = std::vector<std::map<std::string, std::optional<std::string>>>;

namespace tcs {
namespace pool {

class SqlConnRAII {
public:
    SqlConnRAII() : pool_(nullptr), sql_(nullptr) { 
        pool_ = SqlConnPool::instance();
        sql_ = pool_->getConn();
    }

    Connection* getSql() const { return sql_; }

    ~SqlConnRAII() {
        if (sql_) {
            pool_->freeConn(sql_);
        }
    }

private:
    Connection* sql_;
    SqlConnPool* pool_;
};
}  // namespace pool
}  // namespace tcs